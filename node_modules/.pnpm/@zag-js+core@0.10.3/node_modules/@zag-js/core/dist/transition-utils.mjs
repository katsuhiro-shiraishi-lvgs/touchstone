import { determineGuardFn } from './guard-utils.mjs';
import { toArray } from './utils.mjs';
import { isString } from './packages/utilities/core/src/guard.mjs';

function toTarget(target) {
  return isString(target) ? { target } : target;
}
function determineTransitionFn(transitions, guardMap) {
  return (context, event, meta) => {
    return toArray(transitions).map(toTarget).find((transition) => {
      const determineGuard = determineGuardFn(transition.guard, guardMap);
      const guard = determineGuard(context, event, meta);
      return guard ?? transition.target ?? transition.actions;
    });
  };
}

export { determineTransitionFn, toTarget };
